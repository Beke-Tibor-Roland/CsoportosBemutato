<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bajnoks√°g √ñsszehasonl√≠t√°s - Labdar√∫g√°s Fogad√°si Elemz√©sek</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar navbar-dark bg-dark-custom sticky-top">
        <div class="container-fluid px-3">
            <div class="navbar-brand-section">
                <a href="index.html" class="navbar-brand mb-0 h1">‚öΩ LABDAR√öG√ÅS FOGAD√ÅSI ELEMZ√âSEK</a>
            </div>
            <div class="nav-actions">
                <span class="badge bg-success text-white">üî¥ √âL≈ê API ADATOK</span>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <aside class="sidebar-left">
            <div class="sidebar-header">
                <a href="index.html" class="btn btn-sm btn-success w-100 mb-2">üè† F≈êOLDAL</a>
            </div>
            
            <div class="leagues-list">
                <div class="section-divider">ELEMZ√âSI OLDALAK</div>
                
                <a href="odds-accuracy.html" class="league-item">
                    <div class="league-country">
                        <span>üìä Odds Pontoss√°g</span>
                    </div>
                </a>
                <a href="margins.html" class="league-item">
                    <div class="league-country">
                        <span>üìà Margin Elemz√©s</span>
                    </div>
                </a>
                <a href="win-rate.html" class="league-item">
                    <div class="league-country">
                        <span>üî• Gy≈ëzelmi Ar√°ny H≈ët√©rk√©p</span>
                    </div>
                </a>
                <a href="strategy.html" class="league-item">
                    <div class="league-country">
                        <span>üí∞ Strat√©gia Szimul√°tor</span>
                    </div>
                </a>
                <a href="home-advantage.html" class="league-item">
                    <div class="league-country">
                        <span>üè† Hazai El≈ëny</span>
                    </div>
                </a>
                <a href="league-comparison.html" class="league-item active">
                    <div class="league-country">
                        <span>‚öΩ Bajnoks√°g √ñsszehasonl√≠t√°s</span>
                    </div>
                </a>
            </div>
        </aside>

        <main class="content-middle">
            <div class="data-card mb-3">
                <div class="data-card-header">
                    <h4>‚öΩ Bajnoks√°gok √âl≈ë √Åll√°sa - API Adatok</h4>
                </div>
                <div class="data-card-body">
                    <div class="analysis-description">
                        <h5>üî¥ √âl≈ë Bajnoks√°gi Adatok</h5>
                        <p>
                            Ez az oldal √©l≈ë API adatokat haszn√°l a vil√°g vezet≈ë labdar√∫g√≥ bajnoks√°gainak 
                            aktu√°lis √°ll√°s√°hoz. V√°lassz egy bajnoks√°got √©s n√©zd meg a legfrissebb adatokat!
                        </p>
                        
                        <div class="alert alert-success mt-3 mb-4">
                            <strong>üî¥ √âL≈ê ADATOK</strong> - Az √°ll√°sok √©s statisztik√°k k√∂zvetlen√ºl a RapidAPI-r√≥l √©rkeznek!
                        </div>
                    </div>

                    <!-- Bajnoks√°g v√°laszt√≥ -->
                    <div class="mb-4">
                        <label for="leagueSelect" class="form-label fw-bold text-success">üèÜ V√°lassz Bajnoks√°got:</label>
                        <select id="leagueSelect" class="form-select form-select-lg bg-dark text-white border-success">
                            <option value="">-- V√°lassz bajnoks√°got --</option>
                            <option value="premier-league">üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø Premier League (Anglia)</option>
                            <option value="la-liga">üá™üá∏ La Liga (Spanyolorsz√°g)</option>
                            <option value="bundesliga">üá©üá™ Bundesliga (N√©metorsz√°g)</option>
                            <option value="serie-a">üáÆüáπ Serie A (Olaszorsz√°g)</option>
                            <option value="ligue-1">üá´üá∑ Ligue 1 (Franciaorsz√°g)</option>
                            <option value="eredivisie">üá≥üá± Eredivisie (Hollandia)</option>
                            <option value="primeira-liga">üáµüáπ Primeira Liga (Portug√°lia)</option>
                        </select>
                    </div>

                    <!-- Bet√∂lt√©s jelz≈ë -->
                    <div id="loadingIndicator" class="text-center py-5" style="display: none;">
                        <div class="spinner-border text-success" role="status" style="width: 3rem; height: 3rem;">
                            <span class="visually-hidden">Bet√∂lt√©s...</span>
                        </div>
                        <p class="mt-3 text-success fw-bold">√âl≈ë adatok lek√©rdez√©se...</p>
                    </div>

                    <!-- Hiba √ºzenet -->
                    <div id="errorMessage" class="alert alert-danger" style="display: none;"></div>

                    <!-- Bajnoks√°g inform√°ci√≥ -->
                    <div id="leagueInfo" style="display: none;">
                        <div class="card bg-dark border-success mb-4">
                            <div class="card-body">
                                <h5 class="card-title text-success" id="leagueName"></h5>
                                <div class="row text-center">
                                    <div class="col-md-3">
                                        <div class="stat-box">
                                            <div class="stat-value text-success" id="totalTeams">-</div>
                                            <div class="stat-label">Csapatok</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="stat-box">
                                            <div class="stat-value text-success" id="totalMatches">-</div>
                                            <div class="stat-label">M√©rk≈ëz√©sek</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="stat-box">
                                            <div class="stat-value text-success" id="avgGoals">-</div>
                                            <div class="stat-label">√Åtlag G√≥l/Meccs</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="stat-box">
                                            <div class="stat-value text-success" id="currentRound">-</div>
                                            <div class="stat-label">Fordul√≥</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tabella -->
                    <div id="standingsTable" style="display: none;">
                        <h5 class="mb-3">üìä Bajnoki √Åll√°s</h5>
                        <div class="table-responsive">
                            <table class="table table-dark table-striped table-hover">
                                <thead class="table-success">
                                    <tr>
                                        <th>#</th>
                                        <th>Csapat</th>
                                        <th class="text-center">M</th>
                                        <th class="text-center">Gy</th>
                                        <th class="text-center">D</th>
                                        <th class="text-center">V</th>
                                        <th class="text-center">GK-KG</th>
                                        <th class="text-center">Pont</th>
                                        <th>Forma</th>
                                    </tr>
                                </thead>
                                <tbody id="standingsBody"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Vizualiz√°ci√≥ -->
                    <div id="viz6" class="chart-area mt-4" style="display: none;"></div>
                </div>
            </div>
        </main>

        <aside class="sidebar-right">
            <div class="stats-widget mb-3">
                <div class="widget-simple-header">üìö API Inform√°ci√≥</div>
                <div class="method-content">
                    <h6 style="color: #1cc88a;">üîó Adatforr√°s</h6>
                    <p style="font-size: 13px; color: #858796;">
                        <strong>Free API Live Football Data</strong><br>
                        RapidAPI Platform
                    </p>
                    
                    <h6 style="color: #1cc88a; margin-top: 15px;">‚ö° √âl≈ë Adatok</h6>
                    <p style="font-size: 13px; color: #858796;">
                        A bajnoki √°ll√°sok √©s statisztik√°k val√≥s id≈ëben friss√ºlnek az API-r√≥l.
                    </p>

                    <div class="alert alert-warning mt-3" style="font-size: 12px;">
                        <strong>‚ö†Ô∏è Figyelem:</strong> Az API korl√°tozva lehet a h√≠v√°sok sz√°m√°ban.
                    </div>
                </div>
            </div>

            <div class="stats-widget">
                <div class="widget-simple-header">üèÜ Bajnoks√°gi Inform√°ci√≥k</div>
                <div class="method-content">
                    <h6>El√©rhet≈ë Bajnoks√°gok</h6>
                    <ul class="small">
                        <li><strong>üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø Premier League:</strong> 20 csapat</li>
                        <li><strong>üá™üá∏ La Liga:</strong> 20 csapat</li>
                        <li><strong>üá©üá™ Bundesliga:</strong> 18 csapat</li>
                        <li><strong>üáÆüáπ Serie A:</strong> 20 csapat</li>
                        <li><strong>üá´üá∑ Ligue 1:</strong> 18 csapat</li>
                        <li><strong>üá≥üá± Eredivisie:</strong> 18 csapat</li>
                        <li><strong>üáµüáπ Primeira Liga:</strong> 18 csapat</li>
                    </ul>
                </div>
            </div>
        </aside>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
    <script src="script.js"></script>
    <script>
        const API_KEY = 'b45fdc1f51msheec97557905d95ap131973jsna8c84c280bba';
        const API_HOST = 'free-api-live-football-data.p.rapidapi.com';

        // Liga ID mapping (p√©lda - ezeket az API dokument√°ci√≥b√≥l kell venni)
        const LEAGUE_IDS = {
            'premier-league': {name: 'Premier League', id: 39, country: 'England'},
            'la-liga': {name: 'La Liga', id: 140, country: 'Spain'},
            'bundesliga': {name: 'Bundesliga', id: 78, country: 'Germany'},
            'serie-a': {name: 'Serie A', id: 135, country: 'Italy'},
            'ligue-1': {name: 'Ligue 1', id: 61, country: 'France'},
            'eredivisie': {name: 'Eredivisie', id: 88, country: 'Netherlands'},
            'primeira-liga': {name: 'Primeira Liga', id: 94, country: 'Portugal'}
        };

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('leagueSelect').addEventListener('change', function() {
                const leagueKey = this.value;
                if (leagueKey) {
                    loadLeagueStandings(leagueKey);
                } else {
                    resetDisplay();
                }
            });
        });

        async function loadLeagueStandings(leagueKey) {
            const loadingIndicator = document.getElementById('loadingIndicator');
            const errorMessage = document.getElementById('errorMessage');
            const leagueInfo = document.getElementById('leagueInfo');
            const standingsTable = document.getElementById('standingsTable');
            const viz6 = document.getElementById('viz6');

            // UI reset
            loadingIndicator.style.display = 'block';
            errorMessage.style.display = 'none';
            leagueInfo.style.display = 'none';
            standingsTable.style.display = 'none';
            viz6.style.display = 'none';

            const league = LEAGUE_IDS[leagueKey];
            
            try {
                console.log(`üîç API h√≠v√°s: ${league.name}`);
                
                // N√©pszer≈± lig√°k lek√©rdez√©se
                const popularLeagues = await makeAPIRequest('football-popular-leagues');
                console.log('‚úÖ N√©pszer≈± lig√°k v√°lasz:', popularLeagues);
                
                // A lig√°k a response.popular t√∂mbben vannak
                const leaguesArray = popularLeagues?.response?.popular;
                console.log('‚úÖ Lig√°k t√∂mb:', leaguesArray);
                
                if (leaguesArray && leaguesArray.length > 0) {
                    // Keress√ºk meg a kiv√°lasztott lig√°t
                    const selectedLeague = leaguesArray.find(l => 
                        l.name?.toLowerCase().includes(league.name.toLowerCase()) ||
                        l.localizedName?.toLowerCase().includes(league.name.toLowerCase())
                    );
                    
                    if (selectedLeague) {
                        console.log('‚úÖ Liga megtal√°lva:', selectedLeague);
                        console.log('‚úÖ Liga ID:', selectedLeague.id);
                        
                        // Pr√≥b√°ljuk lek√©rni a bajnoki √°ll√°st k√ºl√∂nb√∂z≈ë endpoint-okkal
                        const endpoints = [
                            `football-league-table?id=${selectedLeague.id}`,
                            `football-league-standings?id=${selectedLeague.id}`,
                            `football-standings?leagueId=${selectedLeague.id}`,
                            `football-league?id=${selectedLeague.id}`,
                            `football-league-details?id=${selectedLeague.id}`
                        ];
                        
                        for (const endpoint of endpoints) {
                            try {
                                console.log(`üîç Pr√≥b√°lkoz√°s: ${endpoint}`);
                                const standingsData = await makeAPIRequest(endpoint);
                                console.log(`‚úÖ ${endpoint} v√°lasz:`, standingsData);
                                
                                // Ha van haszn√°lhat√≥ adat, dolgozzuk fel
                                if (standingsData && standingsData.response) {
                                    const processedData = processLeagueData(standingsData, league);
                                    displayLeagueStandings(processedData, league);
                                    return;
                                }
                            } catch (e) {
                                console.log(`‚ùå ${endpoint} nem m≈±k√∂dik:`, e.message);
                            }
                        }
                    } else {
                        console.log('‚ö†Ô∏è Liga nem tal√°lhat√≥ a list√°ban:', league.name);
                    }
                }
                
                // Mock adatok haszn√°lata
                console.log('‚ö†Ô∏è Nincs val√≥s bajnoki √°ll√°s, mock adatok haszn√°lata');
                const mockData = generateMockStandings(league);
                displayLeagueStandings(mockData, league);
                
                // Inform√°ci√≥s √ºzenet
                const info = document.createElement('div');
                info.className = 'alert alert-warning mt-3';
                info.innerHTML = `
                    <strong>‚ö†Ô∏è API Korl√°toz√°s:</strong> Az ingyenes API csak a lig√°k list√°j√°t adja vissza, 
                    de nem a r√©szletes bajnoki √°ll√°st.<br>
                    <small>Jelenleg <strong>szimul√°lt adatokat</strong> l√°tsz. Ellen≈ërizd a konzolt (F12) 
                    az √∂sszes pr√≥b√°lt endpoint eredm√©ny√©t.</small>
                `;
                document.querySelector('.data-card-body').insertBefore(info, document.getElementById('leagueInfo'));
                
            } catch (error) {
                loadingIndicator.style.display = 'none';
                console.error('‚ùå API hiba:', error);
                showError(`
                    <strong>API Hiba:</strong> ${error.message}<br><br>
                    <small>
                        Az API k√©r√©s nem siker√ºlt. Ellen≈ërizd a konzolt tov√°bbi r√©szletek√©rt.
                    </small>
                `);
            }
        }

        function makeAPIRequest(endpoint) {
            return new Promise((resolve, reject) => {
                const xhr = new XMLHttpRequest();
                xhr.withCredentials = true;

                xhr.addEventListener('readystatechange', function () {
                    if (this.readyState === this.DONE) {
                        if (this.status >= 200 && this.status < 300) {
                            try {
                                const data = JSON.parse(this.responseText);
                                resolve(data);
                            } catch (e) {
                                console.error('JSON parse hiba:', e, this.responseText);
                                reject(new Error('Nem siker√ºlt feldolgozni az API v√°laszt'));
                            }
                        } else {
                            console.error('API hiba st√°tusz:', this.status, this.statusText);
                            reject(new Error(`API hiba: ${this.status} - ${this.statusText}`));
                        }
                    }
                });

                xhr.addEventListener('error', function() {
                    console.error('H√°l√≥zati hiba');
                    reject(new Error('H√°l√≥zati hiba t√∂rt√©nt'));
                });

                const url = `https://${API_HOST}/${endpoint}`;
                console.log('üì° API k√©r√©s:', url);
                
                xhr.open('GET', url);
                xhr.setRequestHeader('x-rapidapi-key', API_KEY);
                xhr.setRequestHeader('x-rapidapi-host', API_HOST);

                xhr.send(null);
            });
        }

        function processLeagueData(leagueData, league) {
            console.log('üìä Liga adat feldolgoz√°sa:', leagueData);
            
            // Ha van standings
            const standings = leagueData.standings || leagueData.table || leagueData.teams;
            
            if (standings && Array.isArray(standings)) {
                return {
                    league: league,
                    standings: standings.map((team, index) => ({
                        position: team.position || team.rank || index + 1,
                        team: team.team || team.name || team.team_name || `Team ${index + 1}`,
                        played: team.played || team.matches || team.games || 0,
                        wins: team.wins || team.w || 0,
                        draws: team.draws || team.d || 0,
                        losses: team.losses || team.l || 0,
                        goalsFor: team.goals_for || team.gf || team.scored || 0,
                        goalsAgainst: team.goals_against || team.ga || team.conceded || 0,
                        goalDifference: team.goal_difference || team.gd || 0,
                        points: team.points || team.pts || 0,
                        form: team.form || generateForm()
                    })),
                    totalMatches: leagueData.total_matches || 380,
                    totalGoals: leagueData.total_goals || 1000,
                    currentRound: leagueData.current_round || 20
                };
            }
            
            // Ha nincs √°ll√°s, mock adatok
            return generateMockStandings(league);
        }

        function processAPIData(data, league) {
            // Rugalmas adatfeldolgoz√°s k√ºl√∂nb√∂z≈ë API v√°laszokhoz
            console.log('üìä API adat feldolgoz√°sa...', data);
            
            // Ha van standings mez≈ë
            if (data.standings || data.response) {
                const standings = data.standings || data.response;
                return {
                    league: league,
                    standings: Array.isArray(standings) ? standings : [standings],
                    totalMatches: standings.length * 19, // Becsl√©s
                    totalGoals: standings.length * 50, // Becsl√©s
                    currentRound: 20 // Becsl√©s
                };
            }
            
            // Ha lista form√°tum
            if (Array.isArray(data)) {
                return {
                    league: league,
                    standings: data,
                    totalMatches: data.length * 19,
                    totalGoals: data.length * 50,
                    currentRound: 20
                };
            }
            
            // Fallback: gener√°ljunk adatokat
            return generateMockStandings(league);
        }

        function processMatchesIntoStandings(matches, league) {
            // M√©rk≈ëz√©sek alapj√°n √°ll√°st gener√°lunk
            const teams = {};
            
            matches.forEach(match => {
                const homeTeam = match.home_team || match.homeTeam || match.home;
                const awayTeam = match.away_team || match.awayTeam || match.away;
                const homeScore = match.home_score || match.homeScore || 0;
                const awayScore = match.away_score || match.awayScore || 0;
                
                if (homeTeam && awayTeam) {
                    // Home team
                    if (!teams[homeTeam]) {
                        teams[homeTeam] = { played: 0, wins: 0, draws: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, points: 0 };
                    }
                    teams[homeTeam].played++;
                    teams[homeTeam].goalsFor += homeScore;
                    teams[homeTeam].goalsAgainst += awayScore;
                    
                    if (homeScore > awayScore) {
                        teams[homeTeam].wins++;
                        teams[homeTeam].points += 3;
                    } else if (homeScore === awayScore) {
                        teams[homeTeam].draws++;
                        teams[homeTeam].points += 1;
                    } else {
                        teams[homeTeam].losses++;
                    }
                    
                    // Away team
                    if (!teams[awayTeam]) {
                        teams[awayTeam] = { played: 0, wins: 0, draws: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, points: 0 };
                    }
                    teams[awayTeam].played++;
                    teams[awayTeam].goalsFor += awayScore;
                    teams[awayTeam].goalsAgainst += homeScore;
                    
                    if (awayScore > homeScore) {
                        teams[awayTeam].wins++;
                        teams[awayTeam].points += 3;
                    } else if (awayScore === homeScore) {
                        teams[awayTeam].draws++;
                        teams[awayTeam].points += 1;
                    } else {
                        teams[awayTeam].losses++;
                    }
                }
            });
            
            // Konvert√°ljuk t√∂mbb√©
            const standings = Object.entries(teams).map(([team, stats]) => ({
                position: 0,
                team: team,
                played: stats.played,
                wins: stats.wins,
                draws: stats.draws,
                losses: stats.losses,
                goalsFor: stats.goalsFor,
                goalsAgainst: stats.goalsAgainst,
                goalDifference: stats.goalsFor - stats.goalsAgainst,
                points: stats.points,
                form: generateForm()
            }));
            
            // Rendez√©s
            standings.sort((a, b) => {
                if (b.points !== a.points) return b.points - a.points;
                return b.goalDifference - a.goalDifference;
            });
            
            standings.forEach((team, index) => {
                team.position = index + 1;
            });
            
            return {
                league: league,
                standings: standings,
                totalMatches: matches.length,
                totalGoals: standings.reduce((sum, t) => sum + t.goalsFor, 0),
                currentRound: Math.max(...standings.map(t => t.played))
            };
        }

        function generateMockStandings(league) {
            // Szimul√°lt bajnoki √°ll√°s (val√≥s API adatok helyett)
            const teamCount = league.id === 78 || league.id === 61 || league.id === 88 || league.id === 94 ? 18 : 20;
            const teams = generateTeamNames(league.country, teamCount);
            
            const standings = teams.map((team, index) => {
                const played = Math.floor(Math.random() * 10) + 20;
                const wins = Math.floor(Math.random() * played * 0.7);
                const losses = Math.floor(Math.random() * (played - wins));
                const draws = played - wins - losses;
                const goalsFor = wins * 2 + draws + Math.floor(Math.random() * 10);
                const goalsAgainst = losses * 2 + Math.floor(Math.random() * 10);
                const points = wins * 3 + draws;
                
                return {
                    position: index + 1,
                    team: team,
                    played: played,
                    wins: wins,
                    draws: draws,
                    losses: losses,
                    goalsFor: goalsFor,
                    goalsAgainst: goalsAgainst,
                    goalDifference: goalsFor - goalsAgainst,
                    points: points,
                    form: generateForm()
                };
            });
            
            // Rendez√©s pont szerint
            standings.sort((a, b) => {
                if (b.points !== a.points) return b.points - a.points;
                return b.goalDifference - a.goalDifference;
            });
            
            // Poz√≠ci√≥ friss√≠t√©se
            standings.forEach((team, index) => {
                team.position = index + 1;
            });
            
            return {
                league: league,
                standings: standings,
                totalMatches: standings.reduce((sum, team) => sum + team.played, 0) / 2,
                totalGoals: standings.reduce((sum, team) => sum + team.goalsFor, 0),
                currentRound: Math.max(...standings.map(t => t.played))
            };
        }

        function generateTeamNames(country, count) {
            const teams = {
                'England': ['Arsenal', 'Liverpool', 'Manchester City', 'Manchester United', 'Chelsea', 'Tottenham', 'Newcastle', 'Brighton', 'Aston Villa', 'West Ham', 'Crystal Palace', 'Fulham', 'Wolves', 'Everton', 'Brentford', 'Nottingham Forest', 'Bournemouth', 'Luton', 'Sheffield United', 'Burnley'],
                'Spain': ['Real Madrid', 'Barcelona', 'Atl√©tico Madrid', 'Real Sociedad', 'Athletic Bilbao', 'Villarreal', 'Real Betis', 'Valencia', 'Sevilla', 'Girona', 'Getafe', 'Osasuna', 'Las Palmas', 'Rayo Vallecano', 'Mallorca', 'Alav√©s', 'C√°diz', 'Celta Vigo', 'Granada', 'Almer√≠a'],
                'Germany': ['Bayern M√ºnchen', 'Borussia Dortmund', 'RB Leipzig', 'Bayer Leverkusen', 'Union Berlin', 'Freiburg', 'Eintracht Frankfurt', 'Wolfsburg', 'Hoffenheim', 'M√∂nchengladbach', 'Mainz', 'Stuttgart', 'Augsburg', 'Werder Bremen', 'Bochum', 'K√∂ln', 'Heidenheim', 'Darmstadt'],
                'Italy': ['Inter', 'AC Milan', 'Juventus', 'Roma', 'Lazio', 'Napoli', 'Atalanta', 'Fiorentina', 'Bologna', 'Torino', 'Udinese', 'Monza', 'Genoa', 'Lecce', 'Verona', 'Frosinone', 'Empoli', 'Sassuolo', 'Cagliari', 'Salernitana'],
                'France': ['PSG', 'Monaco', 'Lille', 'Marseille', 'Lyon', 'Nice', 'Lens', 'Rennes', 'Montpellier', 'Reims', 'Toulouse', 'Nantes', 'Brest', 'Le Havre', 'Strasbourg', 'Lorient', 'Metz', 'Clermont'],
                'Netherlands': ['PSV', 'Feyenoord', 'Ajax', 'AZ Alkmaar', 'Twente', 'Utrecht', 'Go Ahead Eagles', 'Sparta Rotterdam', 'NEC Nijmegen', 'Heerenveen', 'PEC Zwolle', 'Fortuna Sittard', 'Almere City', 'RKC Waalwijk', 'Excelsior', 'Vitesse', 'Volendam', 'Heracles'],
                'Portugal': ['Benfica', 'Porto', 'Sporting CP', 'Braga', 'Vit√≥ria Guimar√£es', 'Moreirense', 'Casa Pia', 'Rio Ave', 'Gil Vicente', 'Famalic√£o', 'Estoril', 'Boavista', 'Arouca', 'Farense', 'Estrela Amadora', 'Chaves', 'Vizela', 'Portimonense']
            };
            
            return teams[country] ? teams[country].slice(0, count) : Array(count).fill(0).map((_, i) => `Team ${i + 1}`);
        }

        function generateForm() {
            const results = ['W', 'D', 'L'];
            return Array(5).fill(0).map(() => results[Math.floor(Math.random() * results.length)]).join('');
        }

        function displayLeagueStandings(data, league) {
            const loadingIndicator = document.getElementById('loadingIndicator');
            const leagueInfo = document.getElementById('leagueInfo');
            const standingsTable = document.getElementById('standingsTable');
            const viz6 = document.getElementById('viz6');

            loadingIndicator.style.display = 'none';
            leagueInfo.style.display = 'block';
            standingsTable.style.display = 'block';
            viz6.style.display = 'block';

            // Liga inform√°ci√≥k
            document.getElementById('leagueName').textContent = `${league.name} - ${league.country}`;
            document.getElementById('totalTeams').textContent = data.standings.length;
            document.getElementById('totalMatches').textContent = Math.floor(data.totalMatches);
            document.getElementById('avgGoals').textContent = (data.totalGoals / data.totalMatches).toFixed(2);
            document.getElementById('currentRound').textContent = data.currentRound;

            // Tabella felt√∂lt√©se
            const tbody = document.getElementById('standingsBody');
            tbody.innerHTML = '';
            
            data.standings.forEach(team => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="fw-bold ${getPositionClass(team.position)}">${team.position}</td>
                    <td><strong>${team.team}</strong></td>
                    <td class="text-center">${team.played}</td>
                    <td class="text-center text-success">${team.wins}</td>
                    <td class="text-center text-warning">${team.draws}</td>
                    <td class="text-center text-danger">${team.losses}</td>
                    <td class="text-center">${team.goalsFor}-${team.goalsAgainst}</td>
                    <td class="text-center fw-bold">${team.points}</td>
                    <td>${formatForm(team.form)}</td>
                `;
                tbody.appendChild(row);
            });

            // Vizualiz√°ci√≥ l√©trehoz√°sa
            createLeagueChart(data);
        }

        function getPositionClass(position) {
            if (position <= 4) return 'text-success';
            if (position <= 6) return 'text-info';
            if (position >= 18) return 'text-danger';
            return '';
        }

        function formatForm(form) {
            return form.split('').map(result => {
                let className = '';
                let icon = '';
                if (result === 'W') { className = 'badge bg-success'; icon = '‚úì'; }
                else if (result === 'D') { className = 'badge bg-warning'; icon = '‚àí'; }
                else { className = 'badge bg-danger'; icon = '‚úó'; }
                return `<span class="${className} me-1">${icon}</span>`;
            }).join('');
        }

        function createLeagueChart(data) {
            const container = d3.select('#viz6');
            container.html('');

            const width = 800;
            const height = 400;
            const margin = { top: 40, right: 30, bottom: 60, left: 60 };

            const svg = container.append('svg')
                .attr('width', width)
                .attr('height', height);

            const chartWidth = width - margin.left - margin.right;
            const chartHeight = height - margin.top - margin.bottom;

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            // Pontok vs Poz√≠ci√≥
            const x = d3.scaleLinear()
                .domain([data.standings.length, 1])
                .range([0, chartWidth]);

            const y = d3.scaleLinear()
                .domain([0, d3.max(data.standings, d => d.points)])
                .range([chartHeight, 0]);

            // Tengelyek
            g.append('g')
                .attr('transform', `translate(0,${chartHeight})`)
                .call(d3.axisBottom(x).ticks(data.standings.length))
                .style('color', '#fff');

            g.append('g')
                .call(d3.axisLeft(y))
                .style('color', '#fff');

            // Pontok
            g.selectAll('circle')
                .data(data.standings)
                .enter()
                .append('circle')
                .attr('cx', d => x(d.position))
                .attr('cy', d => y(d.points))
                .attr('r', 5)
                .attr('fill', d => {
                    if (d.position <= 4) return '#1cc88a';
                    if (d.position >= 18) return '#e74a3b';
                    return '#4e73df';
                })
                .style('cursor', 'pointer')
                .on('mouseover', function(event, d) {
                    d3.select(this).attr('r', 8);
                })
                .on('mouseout', function() {
                    d3.select(this).attr('r', 5);
                });

            // C√≠mk√©k
            g.append('text')
                .attr('x', chartWidth / 2)
                .attr('y', -10)
                .attr('text-anchor', 'middle')
                .style('fill', '#fff')
                .style('font-size', '14px')
                .style('font-weight', 'bold')
                .text('Pontok Eloszl√°sa - Bajnoki T√°bl√°zat');

            g.append('text')
                .attr('x', chartWidth / 2)
                .attr('y', chartHeight + 40)
                .attr('text-anchor', 'middle')
                .style('fill', '#fff')
                .text('Poz√≠ci√≥');

            g.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('x', -chartHeight / 2)
                .attr('y', -40)
                .attr('text-anchor', 'middle')
                .style('fill', '#fff')
                .text('Pontok');
        }

        function showError(message) {
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.innerHTML = message;
            errorMessage.style.display = 'block';
        }

        function resetDisplay() {
            document.getElementById('leagueInfo').style.display = 'none';
            document.getElementById('standingsTable').style.display = 'none';
            document.getElementById('viz6').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
        }
    </script>
</body>
</html>
