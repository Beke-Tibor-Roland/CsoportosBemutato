<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Odds Pontoss√°g Elemz√©s - Labdar√∫g√°s Fogad√°si Elemz√©sek</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar navbar-dark bg-dark-custom sticky-top">
        <div class="container-fluid px-3">
            <div class="navbar-brand-section">
                <a href="index.html" class="navbar-brand mb-0 h1">‚öΩ LABDAR√öG√ÅS FOGAD√ÅSI ELEMZ√âSEK</a>
            </div>
            <div class="nav-actions">
                <span class="badge bg-warning text-dark">‚ö†Ô∏è Csak Oktat√°si C√©lra</span>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <aside class="sidebar-left">
            <div class="sidebar-header">
                <a href="index.html" class="btn btn-sm btn-success w-100 mb-2">üè† F≈êOLDAL</a>
            </div>
            
            <div class="leagues-list">
                <div class="section-divider">ELEMZ√âSI OLDALAK</div>
                
                <a href="odds-accuracy.html" class="league-item active">
                    <div class="league-country">
                        <span>üìä Odds Pontoss√°g</span>
                    </div>
                </a>
                <a href="margins.html" class="league-item">
                    <div class="league-country">
                        <span>üìà Margin Elemz√©s</span>
                    </div>
                </a>
                <a href="win-rate.html" class="league-item">
                    <div class="league-country">
                        <span>üî• Gy≈ëzelmi Ar√°ny H≈ët√©rk√©p</span>
                    </div>
                </a>
                <a href="strategy.html" class="league-item">
                    <div class="league-country">
                        <span>üí∞ Strat√©gia Szimul√°tor</span>
                    </div>
                </a>
                <a href="home-advantage.html" class="league-item">
                    <div class="league-country">
                        <span>üè† Hazai El≈ëny</span>
                    </div>
                </a>
                <a href="league-comparison.html" class="league-item">
                    <div class="league-country">
                        <span>‚öΩ Bajnoks√°g √ñsszehasonl√≠t√°s</span>
                    </div>
                </a>
            </div>
        </aside>

        <main class="content-middle">
            <div class="data-card mb-3">
                <div class="data-card-header">
                    <h4>üìä V√°logatottak Gy≈ëzelmi Ar√°nya</h4>
                </div>
                <div class="data-card-body">
                    <div class="analysis-description">
                        <h5>V√°logatottak Keres√©se √©s Gy≈ëzelmi Statisztik√°k</h5>
                        <p>
                            Keress v√°logatottakra √©s n√©zd meg a gy≈ëzelmi ar√°nyukat az adatb√°zisban. 
                            Az adatok 2019-t≈ël napjainkig tartalmazz√°k a nemzetk√∂zi m√©rk≈ëz√©seket.
                        </p>
                        
                        <!-- Leg√∂rd√ºl≈ë lista -->
                        <div class="mb-4">
                            <label for="teamSelect" class="form-label"><strong>üîç V√°logatott v√°laszt√°sa:</strong></label>
                            <select class="form-select" id="teamSelect">
                                <option value="">-- V√°lassz v√°logatottat --</option>
                            </select>
                            <small class="form-text text-muted">V√°lassz egy v√°logatottat a list√°b√≥l</small>
                        </div>

                        <!-- Kiv√°lasztott csapat statisztik√°i -->
                        <div id="teamStats" class="mt-4" style="display: none;">
                            <div class="alert alert-success">
                                <h5 id="teamName"></h5>
                                <div class="row mt-3">
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <h3 class="text-success" id="winRate">-</h3>
                                            <small>Gy≈ëzelmi Ar√°ny</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <h3 class="text-primary" id="totalMatches">-</h3>
                                            <small>√ñsszes M√©rk≈ëz√©s</small>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="text-center">
                                            <h3 class="text-success" id="wins">-</h3>
                                            <small>Gy≈ëzelem</small>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="text-center">
                                            <h3 class="text-warning" id="draws">-</h3>
                                            <small>D√∂ntetlen</small>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="text-center">
                                            <h3 class="text-danger" id="losses">-</h3>
                                            <small>Veres√©g</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <strong>R√∫gott G√≥lok:</strong> <span id="goalsFor">-</span>
                                    </div>
                                    <div class="col-md-6">
                                        <strong>Kapott G√≥lok:</strong> <span id="goalsAgainst">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="viz1" class="chart-area mt-4"></div>
                </div>
            </div>
        </main>

        <aside class="sidebar-right">
            <div class="stats-widget mb-3">
                <div class="widget-simple-header">üìö Adatforr√°s</div>
                <div class="method-content">
                    <h6>Adatb√°zis</h6>
                    <p>Nemzetk√∂zi v√°logatott m√©rk≈ëz√©sek 2019-t≈ël napjainkig</p>
                    
                    <h6>Tartalom</h6>
                    <p>UEFA, FIFA, CONIFA versenysorozatok m√©rk≈ëz√©sei</p>
                    
                    <p class="mt-2"><strong>Gy≈ëzelmi Ar√°ny:</strong></p>
                    <code>Gy≈ëzelmek / √ñsszes_M√©rk≈ëz√©s √ó 100%</code>
                </div>
            </div>

            <div class="stats-widget">
                <div class="widget-simple-header">üéØ Statisztik√°k</div>
                <div class="metrics-content">
                    <div class="metric-item">
                        <div class="metric-label">√ñsszes M√©rk≈ëz√©s</div>
                        <div class="metric-value" id="total-matches">-</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">V√°logatottak Sz√°ma</div>
                        <div class="metric-value" id="total-teams">-</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">Id≈ëszak</div>
                        <div class="metric-value">2019 - 2024</div>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
        crossorigin="anonymous"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        let matchData = [];
        let teamStats = {};

        // CSV bet√∂lt√©se √©s feldolgoz√°sa
        async function loadMatchData() {
            try {
                console.log('üîÑ Adatok bet√∂lt√©se kezd≈ëdik...');
                const response = await fetch('data/adatokfoci.csv');
                
                if (!response.ok) {
                    throw new Error(`HTTP hiba! St√°tusz: ${response.status}`);
                }
                
                const csvText = await response.text();
                console.log('üìÑ CSV bet√∂ltve, karakterek:', csvText.length);
                
                const lines = csvText.trim().split('\n');
                console.log('üìä √ñsszes sor:', lines.length);
                console.log('üìã Els≈ë sor (fejl√©c):', lines[0]);
                
                // Kihagyjuk az els≈ë sort (fejl√©c)
                const dataLines = lines.slice(1);
                console.log('üìä Adat sorok (fejl√©c n√©lk√ºl):', dataLines.length);
                console.log('üìã Els≈ë adat sor:', dataLines[0]);
                
                matchData = dataLines.map(line => {
                    const parts = line.split(',');
                    return {
                        date: parts[0]?.trim(),
                        home: parts[1]?.trim(),
                        away: parts[2]?.trim(),
                        homeScore: parseInt(parts[3]),
                        awayScore: parseInt(parts[4]),
                        tournament: parts[5]?.trim(),
                        neutral: parts[6]?.trim() === 'TRUE'
                    };
                }).filter(match => match.home && match.away && !isNaN(match.homeScore) && !isNaN(match.awayScore));

                console.log('‚úÖ Feldolgozott m√©rk≈ëz√©sek:', matchData.length);
                console.log('üîç Els≈ë m√©rk≈ëz√©s:', matchData[0]);
                
                calculateTeamStats();
                console.log('üìä Csapatok sz√°ma:', Object.keys(teamStats).length);
                console.log('üîç Els≈ë 10 csapat:', Object.keys(teamStats).sort().slice(0, 10));
                
                updateOverallStats();
                populateTeamSelect();
                
                console.log('‚úÖ Minden k√©sz! Lista elemek sz√°ma:', document.getElementById('teamSelect').options.length);
            } catch (error) {
                console.error('‚ùå Hiba az adatok bet√∂lt√©s√©n√©l:', error);
                alert('Hiba: Nem siker√ºlt bet√∂lteni az adatokat. Ellen≈ërizd a konzolt (F12) a r√©szletek√©rt.');
            }
        }

        // Csapatok statisztik√°inak kisz√°m√≠t√°sa
        function calculateTeamStats() {
            teamStats = {};

            matchData.forEach(match => {
                if (!match.home || !match.away) return;

                // Hazai csapat
                if (!teamStats[match.home]) {
                    teamStats[match.home] = { matches: 0, wins: 0, draws: 0, losses: 0, goalsFor: 0, goalsAgainst: 0 };
                }
                teamStats[match.home].matches++;
                teamStats[match.home].goalsFor += match.homeScore;
                teamStats[match.home].goalsAgainst += match.awayScore;

                if (match.homeScore > match.awayScore) {
                    teamStats[match.home].wins++;
                } else if (match.homeScore === match.awayScore) {
                    teamStats[match.home].draws++;
                } else {
                    teamStats[match.home].losses++;
                }

                // Vend√©g csapat
                if (!teamStats[match.away]) {
                    teamStats[match.away] = { matches: 0, wins: 0, draws: 0, losses: 0, goalsFor: 0, goalsAgainst: 0 };
                }
                teamStats[match.away].matches++;
                teamStats[match.away].goalsFor += match.awayScore;
                teamStats[match.away].goalsAgainst += match.homeScore;

                if (match.awayScore > match.homeScore) {
                    teamStats[match.away].wins++;
                } else if (match.homeScore === match.awayScore) {
                    teamStats[match.away].draws++;
                } else {
                    teamStats[match.away].losses++;
                }
            });
        }

        // Oldal bet√∂lt√©se
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Oldal bet√∂ltve, adatok lek√©r√©se indul...');
            loadMatchData();

            const teamSelect = document.getElementById('teamSelect');

            teamSelect.addEventListener('change', function() {
                const teamName = this.value;
                if (teamName) {
                    showTeamStats(teamName);
                } else {
                    document.getElementById('teamStats').style.display = 'none';
                    d3.select('#viz1').selectAll('*').remove();
                }
            });
        });

        // Leg√∂rd√ºl≈ë lista felt√∂lt√©se
        function populateTeamSelect() {
            const teamSelect = document.getElementById('teamSelect');
            const teams = Object.keys(teamStats).sort();

            console.log('üìã Leg√∂rd√ºl≈ë lista felt√∂lt√©se kezd≈ëdik...');
            console.log('üìä Csapatok sz√°ma:', teams.length);
            console.log('üîç Els≈ë 10 csapat:', teams.slice(0, 10));

            // T√∂r√∂lj√ºk az alap√©rtelmezett opci√≥n k√≠v√ºl mindent
            teamSelect.innerHTML = '<option value="">-- V√°lassz v√°logatottat --</option>';

            teams.forEach((team, index) => {
                const option = document.createElement('option');
                option.value = team;
                option.textContent = team;
                teamSelect.appendChild(option);
                
                if (index < 5) {
                    console.log(`  ‚ûï Hozz√°adva: ${team}`);
                }
            });

            console.log('‚úÖ Leg√∂rd√ºl≈ë lista felt√∂ltve:', teamSelect.options.length, 'opci√≥');
        }

        // Csapat statisztik√°inak megjelen√≠t√©se
        function showTeamStats(teamName) {
            const stats = teamStats[teamName];
            if (!stats) return;

            const winRate = ((stats.wins / stats.matches) * 100).toFixed(1);

            document.getElementById('teamStats').style.display = 'block';
            document.getElementById('teamName').textContent = `üèÜ ${teamName}`;
            document.getElementById('winRate').textContent = `${winRate}%`;
            document.getElementById('totalMatches').textContent = stats.matches;
            document.getElementById('wins').textContent = stats.wins;
            document.getElementById('draws').textContent = stats.draws;
            document.getElementById('losses').textContent = stats.losses;
            document.getElementById('goalsFor').textContent = stats.goalsFor;
            document.getElementById('goalsAgainst').textContent = stats.goalsAgainst;

            createTeamChart(teamName, stats);
        }

        // √ñsszes√≠tett statisztik√°k
        function updateOverallStats() {
            document.getElementById('total-matches').textContent = matchData.length;
            document.getElementById('total-teams').textContent = Object.keys(teamStats).length;
        }

        // Csapat diagram
        function createTeamChart(teamName, stats) {
            const viz = d3.select('#viz1');
            viz.selectAll('*').remove();

            const data = [
                { label: 'Gy≈ëzelem', value: stats.wins, color: '#28a745' },
                { label: 'D√∂ntetlen', value: stats.draws, color: '#ffc107' },
                { label: 'Veres√©g', value: stats.losses, color: '#dc3545' }
            ];

            const width = viz.node().getBoundingClientRect().width;
            const height = 400;
            const margin = { top: 40, right: 30, bottom: 80, left: 60 };

            const svg = viz.append('svg')
                .attr('width', width)
                .attr('height', height);

            const chartWidth = width - margin.left - margin.right;
            const chartHeight = height - margin.top - margin.bottom;

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            const x = d3.scaleBand()
                .domain(data.map(d => d.label))
                .range([0, chartWidth])
                .padding(0.3);

            const y = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.value)])
                .nice()
                .range([chartHeight, 0]);

            g.selectAll('.bar')
                .data(data)
                .enter()
                .append('rect')
                .attr('class', 'bar')
                .attr('x', d => x(d.label))
                .attr('y', d => y(d.value))
                .attr('width', x.bandwidth())
                .attr('height', d => chartHeight - y(d.value))
                .attr('fill', d => d.color);

            g.selectAll('.label')
                .data(data)
                .enter()
                .append('text')
                .attr('x', d => x(d.label) + x.bandwidth() / 2)
                .attr('y', d => y(d.value) - 5)
                .attr('text-anchor', 'middle')
                .attr('fill', '#fff')
                .style('font-size', '14px')
                .style('font-weight', 'bold')
                .text(d => d.value);

            g.append('g')
                .attr('transform', `translate(0,${chartHeight + 5})`)
                .call(d3.axisBottom(x))
                .selectAll('text')
                .style('fill', '#fff');
            
            g.selectAll('.domain')
                .remove();
            
            g.selectAll('.tick line')
                .remove();

            g.append('g')
                .call(d3.axisLeft(y))
                .selectAll('text')
                .style('fill', '#fff');

            svg.append('text')
                .attr('x', width / 2)
                .attr('y', 20)
                .attr('text-anchor', 'middle')
                .style('font-size', '18px')
                .style('font-weight', 'bold')
                .style('fill', '#fff')
                .text(`${teamName} - M√©rk≈ëz√©s Eredm√©nyek`);
        }

        function createAllVisualizations() {
            // Nincs sz√ºks√©g vizualiz√°ci√≥ra automatikusan
        }
    </script>
</body>
</html>
