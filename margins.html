<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fogad√≥irodai Margin - Labdar√∫g√°s Fogad√°si Elemz√©sek</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar navbar-dark bg-dark-custom sticky-top">
        <div class="container-fluid px-3">
            <div class="navbar-brand-section">
                <a href="index.html" class="navbar-brand mb-0 h1">‚öΩ LABDAR√öG√ÅS FOGAD√ÅSI ELEMZ√âSEK</a>
            </div>
            <div class="nav-actions">
                <span class="badge bg-warning text-dark">‚ö†Ô∏è Csak Oktat√°si C√©lra</span>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <aside class="sidebar-left">
            <div class="sidebar-header">
                <a href="index.html" class="btn btn-sm btn-success w-100 mb-2">üè† F≈êOLDAL</a>
            </div>
            
            <div class="leagues-list">
                <div class="section-divider">ELEMZ√âSI OLDALAK</div>
                
                <a href="odds-accuracy.html" class="league-item">
                    <div class="league-country">
                        <span>üìä Odds Pontoss√°g</span>
                    </div>
                </a>
                <a href="margins.html" class="league-item active">
                    <div class="league-country">
                        <span>üìà Margin Elemz√©s</span>
                    </div>
                </a>
                <a href="win-rate.html" class="league-item">
                    <div class="league-country">
                        <span>üî• Gy≈ëzelmi Ar√°ny H≈ët√©rk√©p</span>
                    </div>
                </a>
                <a href="strategy.html" class="league-item">
                    <div class="league-country">
                        <span>üí∞ Strat√©gia Szimul√°tor</span>
                    </div>
                </a>
                <a href="home-advantage.html" class="league-item">
                    <div class="league-country">
                        <span>üè† Hazai El≈ëny</span>
                    </div>
                </a>
                <a href="league-comparison.html" class="league-item">
                    <div class="league-country">
                        <span>‚öΩ Bajnoks√°g √ñsszehasonl√≠t√°s</span>
                    </div>
                </a>
            </div>
        </aside>

        <main class="content-middle">
            <div class="data-card mb-3">
                <div class="data-card-header">
                    <h4>ÔøΩ √âL≈ê M√©rk≈ëz√©sek - Fogad√≥irodai Margin Elemz√©s</h4>
                    <button class="btn btn-sm btn-outline-success" onclick="refreshLiveData()">üîÑ Friss√≠t√©s</button>
                </div>
                <div class="data-card-body">
                    <div class="analysis-description">
                        <h5>√âl≈ë √©s K√∂zelg≈ë M√©rk≈ëz√©sek Marginj√°nak Elemz√©se</h5>
                        <p>
                            Ez az oldal <strong>√©l≈ë adatokat</strong> mutat az aktu√°lis √©s k√∂zelg≈ë m√©rk≈ëz√©sekr≈ël. 
                            A fogad√≥irodai margin (overround) a fogad√≥iroda be√©p√≠tett profitj√°t jelenti.
                        </p>
                        
                        <div id="live-stats" class="alert alert-info">
                            <strong>üìä Adatok bet√∂lt√©se...</strong>
                        </div>

                        <h6>Mit l√°tsz itt:</h6>
                        <ul>
                            <li><strong>T√∂bb Bookmaker:</strong> √ñsszehasonl√≠tjuk a k√ºl√∂nb√∂z≈ë fogad√≥irod√°k margin-jait</li>
                            <li><strong>Margin V√°ltoz√°s:</strong> L√°thatod melyik fogad√≥iroda k√≠n√°l jobb √©rt√©ket</li>
                            <li><strong>√âl≈ë Friss√≠t√©s:</strong> Az adatok az API lek√©rdez√©s idej√©n √©rv√©nyesek</li>
                        </ul>

                        <div class="alert alert-warning mt-3">
                            <strong>‚ö†Ô∏è Fontos:</strong> Alacsonyabb margin = Jobb √©rt√©k a fogad√≥k sz√°m√°ra!
                            Keresd a legalacsonyabb margin-√∫ fogad√≥irod√°kat a legjobb odds-ok√©rt.
                        </div>
                    </div>

                    <div id="viz2" class="chart-area"></div>
                    
                    <div id="matches-list" class="mt-4"></div>
                </div>
            </div>
        </main>

        <aside class="sidebar-right">
            <div class="stats-widget mb-3">
                <div class="widget-simple-header">ÔøΩ √âL≈ê St√°tusz</div>
                <div class="method-content">
                    <div class="metric-item">
                        <div class="metric-label">Utols√≥ friss√≠t√©s:</div>
                        <div class="metric-value" id="last-update">-</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">√âl≈ë m√©rk≈ëz√©sek:</div>
                        <div class="metric-value text-danger" id="live-count">0</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">K√∂zelg≈ë (48h):</div>
                        <div class="metric-value text-warning" id="upcoming-count">0</div>
                    </div>
                    
                    <button class="btn btn-sm btn-primary w-100 mt-3" onclick="refreshLiveData()">
                        üîÑ Adatok friss√≠t√©se
                    </button>
                    
                    <div class="alert alert-info mt-3 small">
                        <strong>üí° Tipp:</strong> Friss√≠tsd az adatokat 15-30 percenk√©nt az aktu√°lis odds-ok√©rt!
                    </div>
                </div>
            </div>

            <div class="stats-widget mb-3">
                <div class="widget-simple-header">üìö M√≥dszertan</div>
                <div class="method-content">
                    <h6>Margin Sz√°m√≠t√°s</h6>
                    <code>
                        Margin = (1/H + 1/D + 1/A - 1) √ó 100%
                    </code>
                    
                    <p class="mt-3"><strong>P√©lda:</strong></p>
                    <p>Hazai: 2.00 (50%)<br>
                       D√∂ntetlen: 3.50 (28.6%)<br>
                       Vend√©g: 3.50 (28.6%)</p>
                    <p><strong>Margin: 7.2%</strong></p>

                    <div class="alert alert-success mt-3 small">
                        <strong>‚úÖ J√≥ margin:</strong> &lt; 5%<br>
                        <strong>‚ö†Ô∏è √Åtlagos:</strong> 5-8%<br>
                        <strong>‚ùå Magas:</strong> &gt; 8%
                    </div>
                </div>
            </div>

            <div class="stats-widget">
                <div class="widget-simple-header">üìä Statisztik√°k</div>
                <div class="metrics-content">
                    <div class="metric-item">
                        <div class="metric-label">√Åtlag Margin</div>
                        <div class="metric-value" id="avg-margin">-</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">Legjobb Margin</div>
                        <div class="metric-value text-success" id="min-margin">-</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">Legrosszabb Margin</div>
                        <div class="metric-value text-danger" id="max-margin">-</div>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
        crossorigin="anonymous"></script>
    <script src="script.js"></script>
    <script>
        let liveMatchesData = null;

        document.addEventListener('DOMContentLoaded', function() {
            loadLiveMatches();
        });
        
        async function loadLiveMatches() {
            try {
                console.log('üì° √âl≈ë m√©rk≈ëz√©sek bet√∂lt√©se...');
                const response = await fetch('data/live_matches.json');
                
                if (!response.ok) {
                    throw new Error('Nincs √©l≈ë adat - futtasd a fetch_live_matches.py scriptet!');
                }
                
                liveMatchesData = await response.json();
                console.log(`‚úÖ ${liveMatchesData.total_matches} √©l≈ë/k√∂zelg≈ë m√©rk≈ëz√©s bet√∂ltve`);
                
                updateLiveStats();
                createLiveViz2();
                displayMatchesList();
                
            } catch (error) {
                console.error('‚ùå Hiba:', error);
                document.getElementById('live-stats').innerHTML = `
                    <strong>‚ö†Ô∏è Nincs √©l≈ë adat!</strong><br>
                    <small>Futtasd: <code>python fetch_live_matches.py</code></small>
                `;
                document.getElementById('viz2').innerHTML = `
                    <div class="loading">
                        <p>Futtasd a <code>fetch_live_matches.py</code> scriptet az √©l≈ë adatok√©rt!</p>
                        <p><code>python fetch_live_matches.py</code></p>
                    </div>
                `;
            }
        }
        
        function updateLiveStats() {
            if (!liveMatchesData) return;
            
            const matches = liveMatchesData.matches;
            const liveCount = matches.filter(m => m.status.includes('üî¥')).length;
            const upcomingCount = matches.length - liveCount;
            
            // Margin statisztik√°k
            const margins = matches.map(m => m.avg_margin);
            const avgMargin = (margins.reduce((a, b) => a + b, 0) / margins.length).toFixed(2);
            const minMargin = Math.min(...margins).toFixed(2);
            const maxMargin = Math.max(...margins).toFixed(2);
            
            document.getElementById('last-update').textContent = new Date(liveMatchesData.updated).toLocaleString('hu-HU');
            document.getElementById('live-count').textContent = liveCount;
            document.getElementById('upcoming-count').textContent = upcomingCount;
            document.getElementById('avg-margin').textContent = avgMargin + '%';
            document.getElementById('min-margin').textContent = minMargin + '%';
            document.getElementById('max-margin').textContent = maxMargin + '%';
            
            document.getElementById('live-stats').innerHTML = `
                <strong>üìä ${matches.length} m√©rk≈ëz√©s bet√∂ltve</strong><br>
                <small>Utolj√°ra friss√≠tve: ${new Date(liveMatchesData.updated).toLocaleString('hu-HU')}</small><br>
                <small>üî¥ ${liveCount} √©l≈ë | ‚è∞ ${upcomingCount} k√∂zelg≈ë</small>
            `;
        }
        
        function createLiveViz2() {
            // Haszn√°ljuk az √∫j createLiveMarginChart f√ºggv√©nyt √©l≈ë adatokkal
            if (liveMatchesData && typeof window.createLiveMarginChart === 'function') {
                window.createLiveMarginChart(liveMatchesData);
            } else {
                console.warn('Nincs √©l≈ë adat vagy createLiveMarginChart nem tal√°lhat√≥');
                document.getElementById('viz2').innerHTML = `
                    <div class="loading">
                        <p>‚ö†Ô∏è Futtasd a scriptet az √©l≈ë adatok√©rt:</p>
                        <p><code>python fetch_live_matches.py</code></p>
                    </div>
                `;
            }
        }
        
        function displayMatchesList() {
            if (!liveMatchesData) return;
            
            const container = document.getElementById('matches-list');
            const matches = liveMatchesData.matches;
            
            let html = '<h5>üìã M√©rk≈ëz√©sek list√°ja</h5>';
            html += '<div class="table-responsive"><table class="table table-sm table-dark table-hover">';
            html += '<thead><tr><th>St√°tusz</th><th>Liga</th><th>M√©rk≈ëz√©s</th><th>Bookmakers</th><th>√Åtlag Margin</th></tr></thead><tbody>';
            
            matches.forEach(match => {
                html += `<tr>
                    <td>${match.status}</td>
                    <td><small>${match.league}</small></td>
                    <td><strong>${match.home_team}</strong> vs <strong>${match.away_team}</strong></td>
                    <td><small>${match.num_bookmakers} iroda</small></td>
                    <td><span class="badge ${match.avg_margin < 5 ? 'bg-success' : match.avg_margin < 8 ? 'bg-warning' : 'bg-danger'}">${match.avg_margin}%</span></td>
                </tr>`;
            });
            
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }
        
        function refreshLiveData() {
            document.getElementById('live-stats').innerHTML = '<strong>üîÑ Friss√≠t√©s...</strong>';
            loadLiveMatches();
        }
    </script>
</body>
</html>
